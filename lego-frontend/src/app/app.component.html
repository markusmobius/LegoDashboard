<main class="main">
  <div class="app-container">
    <div class="dashboard-container" [class.split-screen]="isSplitScreen()">
      <div 
        class="panel" 
        *ngFor="let panel of panels(); let i = index" 
        [class.left-panel]="isSplitScreen() && i === 0"
        [class.right-panel]="isSplitScreen() && i === 1">
        
        <!-- New compact panel header -->
        <div class="panel-header-compact">
          <div class="date-picker-container">
            <mat-form-field appearance="outline" subscriptSizing="dynamic">
              <mat-label>Select Date</mat-label>
              <input 
                matInput 
                [matDatepicker]="picker" 
                [value]="panel.selectedDate"
                (dateChange)="onDateChange(panel.id, $event.value)">
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
          </div>
          
          <!-- Panel controls on the right -->
          <div class="panel-controls">
            <!-- "Add Column" button with text, shown only for the first panel -->
            <button 
              *ngIf="panels().length === 1"
              (click)="addPanel()" 
              mat-button
              class="add-panel-btn">
              <mat-icon>add</mat-icon>
              Add Column
            </button>
            
            <!-- "Close" icon button, shown only when there are two panels -->
            <button 
              *ngIf="panels().length > 1"
              (click)="removePanel(panel.id)"
              mat-icon-button
              matTooltip="Close Column">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>

        <div class="panel-content">
          <!-- Actions now use a dense mat-list for compactness -->
          <mat-list dense>
            <mat-list-item 
              *ngFor="let action of panel.actions"
              lines="2"
              (click)="openActionDetail(action)"
              class="clickable-action">
              
              <!-- Wrapper to control layout of title and bars -->
              <div class="action-content-wrapper">
                <!-- First line: Action description -->
                <div class="action-description">
                  {{ action.Description }}
                </div>
                
                <!-- Second line: Visual bars using reusable component -->
                <app-action-bars 
                  [data]="getActionBarData(action)"
                  [allData]="getAllActionBarData(panel.actions)">
                </app-action-bars>
              </div>
            </mat-list-item>
          </mat-list>
        </div>
      </div>
    </div>
  </div>
</main>