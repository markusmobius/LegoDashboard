<main class="main">
  <div class="app-container">
    <nav class="top-nav">
      <div class="nav-actions">
        <button class="add-panel-btn" (click)="addPanel()" [disabled]="panels().length >= 2" mat-button>
          <mat-icon>add</mat-icon>
          Add Column
        </button>
      </div>
    </nav>

    <div class="dashboard-container" [class.split-screen]="isSplitScreen()">
      <div 
        class="panel" 
        *ngFor="let panel of panels(); let i = index" 
        [class.left-panel]="isSplitScreen() && i === 0"
        [class.right-panel]="isSplitScreen() && i === 1">
        
        <div class="panel-header">
          <button 
            class="close-panel-btn" 
            (click)="removePanel(panel.id)" 
            [disabled]="panels().length === 1"
            mat-icon-button>
            <mat-icon>close</mat-icon>
          </button>
        </div>

        <div class="panel-content">
          <div class="date-picker-container">
            <mat-form-field appearance="outline">
              <mat-label>Select Date</mat-label>
              <input 
                matInput 
                [matDatepicker]="picker" 
                [value]="panel.selectedDate"
                (dateChange)="onDateChange(panel.id, $event.value)">
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
          </div>
          
          <!-- Actions with visual bars -->
          <div class="actions-container">
            <h3>Actions ({{ panel.actions.length }})</h3>
            
            <div class="action-item" *ngFor="let action of panel.actions">
              <!-- First subrow: Action description -->
              <div class="action-description">
                {{ action.Description }}
              </div>
              
              <!-- Second subrow: Visual bars -->
              <div class="action-bars">
                <!-- Coverage bar section (1/3 width) -->
                <div class="coverage-section">
                  <div 
                    class="coverage-bar-container"
                    [matTooltip]="'Coverage: ' + (action.coverage | number:'1.2-2')"
                    matTooltipPosition="above">
                    <div 
                      class="coverage-bar"
                      [style.width.%]="getCoverageWidth(action.coverage, panel.actions)">
                    </div>
                  </div>
                </div>
                
                <!-- SNO bar section (2/3 width) - Fixed width -->
                <div class="sno-section">
                  <div class="sno-bar-container">
                    <!-- Support segment (green) -->
                    <div 
                      class="sno-segment support"
                      [style.width.%]="action.agreement[0] * 100"
                      [matTooltip]="'Support: ' + (action.agreement[0] | percent:'1.1-1')"
                      matTooltipPosition="above">
                    </div>
                    <!-- Neutral segment (gray) -->
                    <div 
                      class="sno-segment neutral"
                      [style.width.%]="action.agreement[1] * 100"
                      [matTooltip]="'Neutral: ' + (action.agreement[1] | percent:'1.1-1')"
                      matTooltipPosition="above">
                    </div>
                    <!-- Oppose segment (red) -->
                    <div 
                      class="sno-segment oppose"
                      [style.width.%]="action.agreement[2] * 100"
                      [matTooltip]="'Oppose: ' + (action.agreement[2] | percent:'1.1-1')"
                      matTooltipPosition="above">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>