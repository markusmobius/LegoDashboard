<main class="main">
  <div class="app-container">
    <div class="dashboard-container" [class.split-screen]="isSplitScreen()">
      <div 
        class="panel" 
        *ngFor="let panel of panels(); let i = index" 
        [class.left-panel]="isSplitScreen() && i === 0"
        [class.right-panel]="isSplitScreen() && i === 1">
        
        <!-- New compact panel header -->
        <div class="panel-header-compact">
          <div class="date-picker-container">
            <mat-form-field appearance="outline" subscriptSizing="dynamic">
              <mat-label>Select Date</mat-label>
              <input 
                matInput 
                [matDatepicker]="picker" 
                [value]="panel.selectedDate"
                (dateChange)="onDateChange(panel.id, $event.value)">
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
          </div>
          
          <!-- Panel controls on the right -->
          <div class="panel-controls">
            <!-- "Add Column" button with text, shown only for the first panel -->
            <button 
              *ngIf="panels().length === 1"
              (click)="addPanel()" 
              mat-button
              class="add-panel-btn">
              <mat-icon>add</mat-icon>
              Add Column
            </button>
            
            <!-- "Close" icon button, shown only when there are two panels -->
            <button 
              *ngIf="panels().length > 1"
              (click)="removePanel(panel.id)"
              mat-icon-button
              matTooltip="Close Column">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>

        <div class="panel-content">
          <!-- Actions now use a dense mat-list for compactness -->
          <mat-list dense>
            <mat-list-item 
              *ngFor="let action of panel.actions"
              lines="2">
              
              <!-- First line: Action description -->
              <div matListItemTitle class="action-description">
                {{ action.Description }}
              </div>
              
              <!-- Second line: Visual bars -->
              <div matListItemLine class="action-bars">
                <!-- Coverage bar section (1/3 width) -->
                <div class="coverage-section">
                  <div 
                    class="coverage-bar-container"
                    [matTooltip]="'Coverage: ' + (action.coverage | number:'1.2-2')"
                    matTooltipPosition="above">
                    <div 
                      class="coverage-bar"
                      [style.width.%]="getCoverageWidth(action.coverage, panel.actions)">
                    </div>
                  </div>
                </div>
                
                <!-- SNO bar section (2/3 width) -->
                <div class="sno-section">
                  <div class="sno-bar-container">
                    <!-- Support segment (green) -->
                    <div 
                      class="sno-segment support"
                      [style.width.%]="action.agreement[0] * 100"
                      [matTooltip]="'Support: ' + (action.agreement[0] | percent:'1.1-1')"
                      matTooltipPosition="above">
                    </div>
                    <!-- Neutral segment (gray) -->
                    <div 
                      class="sno-segment neutral"
                      [style.width.%]="action.agreement[1] * 100"
                      [matTooltip]="'Neutral: ' + (action.agreement[1] | percent:'1.1-1')"
                      matTooltipPosition="above">
                    </div>
                    <!-- Oppose segment (red) -->
                    <div 
                      class="sno-segment oppose"
                      [style.width.%]="action.agreement[2] * 100"
                      [matTooltip]="'Oppose: ' + (action.agreement[2] | percent:'1.1-1')"
                      matTooltipPosition="above">
                    </div>
                  </div>
                </div>
              </div>
            </mat-list-item>
          </mat-list>
        </div>
      </div>
    </div>
  </div>
</main>